sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/m/MessageBox","com/pso/customerattribute/utils/Formatter"],function(e,t,s,o){"use strict";return e.extend("com.pso.customerattribute.controller.CustomerSpecials",{onInit:function(){var e=this.getOwnerComponent().getRouter();e.getRoute("CustomerSpecials").attachMatched(function(e){this._loadFragmentPerScope(e.getParameter("arguments").scope)},this)},_loadFragmentPerScope:function(e){this.initializBusyIndicator();var t=this.getOwnerComponent().getModel("oSpecialsjmodel").getData().ID;var s=this.getOwnerComponent().getModel("oSpecialsjmodel").getData().record_status;this.record_status=s;this.onDisplaySpecials();if(s!==undefined&&s!==""&&s!==null){if(s==="Submitted"){this.getView().byId("idSpecialsStatusMessage").setText("Record is submitted for approval.");this.getView().byId("_IDEditSpecials").setVisible(false)}else if(s==="Approved"){this.getView().byId("idSpecialsStatusMessage").setText("Record is approved. Any edit will create a new version.")}else if(s==="Rejected"){this.getView().byId("idSpecialsStatusMessage").setText("Record is rejected. Please modify and submit for approval.")}else if(s==="Draft"){this.getView().byId("idSpecialsStatusMessage").setText("Record is in draft version.")}}},initializBusyIndicator:function(){this.oBusyIndicator=0;this.oBusyIndicator=this.oBusyIndicator?this.oBusyIndicator:new sap.m.BusyDialog({text:"",title:""});return this.oBusyIndicator},setVisibleCreateSpecialPanel:function(e){this.getView().byId("idpanelCreateSpecials").setVisible(e)},onEditSpecials:function(){this.setVisibleCreateSpecialPanel(true);this.getView().byId("_IDButtonSaveDraft").setVisible(true);this.getView().byId("_IDButtonSaveSubmit").setVisible(false);this.getView().byId("idpanelDisplaySpecials").setVisible(false);this.getView().byId("_IDEditSpecials").setVisible(false)},onDisplaySpecials:function(){let e=this.getOwnerComponent().getModel("oUserScopeJModel").getData();this.setVisibleCreateSpecialPanel(false);this.getView().byId("idpanelDisplaySpecials").setVisible(true);this.getView().byId("_IDButtonSaveDraft").setVisible(false);if(e.hasSpecialsEditAccess){console.log(this.record_status);if(this.record_status==="Draft"){this.getView().byId("_IDButtonSaveSubmit").setVisible(true)}else{this.getView().byId("_IDButtonSaveSubmit").setVisible(false)}this.getView().byId("_IDEditSpecials").setVisible(true)}else{this.getView().byId("_IDButtonSaveSubmit").setVisible(false);this.getView().byId("_IDEditSpecials").setVisible(false)}},onAfterRendering:function(){},onSaveAsDraftSpecials:async function(e){var t=this;t.oBusyIndicator.open();const o=this.getOwnerComponent().getModel("oSpecialsjmodel").getData().ID;const i=this.getOwnerComponent().getModel("oSpecialsjmodel").getData().record_status;const n=this.getOwnerComponent().getModel("oSpecialsjmodel").getData().connection_object;let r=this.getOwnerComponent().getModel().sServiceUrl;if(i==="Approved"){var a=this.getCreateContext_Submit();console.log(a);a.record_status="Draft";try{const e=await fetch(r+"PSOSpecials",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!e.ok){throw new Error(`HTTP error! status: ${e.status}`)}const o=await e.json();t.oBusyIndicator.close();s.success("PSO Specials Record for connection object "+n+" saved successfully!!!",{actions:["Submit for Approval",s.Action.OK],emphasizedAction:s.Action.OK,onClose:function(e){if(e==="Submit for Approval"){t.onSubmitSpecials()}else{window.history.go(-2)}},dependentOn:t.getView()});console.log("success POST record ");return o}catch(e){console.error("Error:",e.message);t.oBusyIndicator.close()}}else{var a=this.getCreateContext();console.log(a);a.record_status="Draft";const e=r+"PSOSpecials(ID="+o+",connection_object='"+n+"')";try{var c;const o={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)};await fetch(e,o).then(e=>e.json()).then(e=>{c=e;console.log(e)}).catch(e=>console.error(e));s.success("PSO Specials Record for connection object "+n+" saved successfully!!!",{actions:["Submit for Approval",s.Action.OK],emphasizedAction:s.Action.OK,onClose:function(e){if(e==="Submit for Approval"){t.onSubmitSpecials()}else{window.history.go(-2)}},dependentOn:t.getView()});console.log("UPDATE success");t.oBusyIndicator.close();return c}catch(e){t.oBusyIndicator.close();console.error("Error:",e.message)}}},onSubmitSpecials:async function(e){var t=this;var o=t.getView().byId("idrep_CS").getSelectedKey();if(o===""){sap.m.MessageBox.show(this.getView().getModel("i18n").getProperty("PSR_Mandat"),{icon:sap.m.MessageBox.Icon.WARNING,title:this.getView().getModel("i18n").getProperty("error"),actions:[sap.m.MessageBox.Action.OK]});jQuery.sap.delayedCall(500,this,function(){this.getView().byId("idCNrep_DS").focus()});return}const i=this.getOwnerComponent().getModel("oSpecialsjmodel").getData().connection_object;t.oBusyIndicator.open();var n=this.getOwnerComponent().getModel();var r=n.bindContext("/submitSpecials(...)");r.setParameter("connection_object",i);await r.execute().then(function(e){t.oBusyIndicator.close();var o=r.getBoundContext().getObject();s.success("PSO Specials Record for connection object "+i+" submitted successfully!!!",{actions:[s.Action.OK],emphasizedAction:s.Action.OK,onClose:function(e){window.history.go(-2)},dependentOn:t.getView()});console.log("success onSubmitSpecials ")}.bind(this),function(e){t.oBusyIndicator.close();console.log("failure: = "+e.message)}.bind(this))},getCreateContext:function(){const e=this.getOwnerComponent().getModel("oCustomerAttributesJModel").getData();var t=this.getOwnerComponent().getModel("oSpecialsjmodel").getData();var s=this.getView().byId("idRadio1_CS").getSelectedButton().getText();var o=this.getView().byId("grop5CPSR_CS").getSelectedButton().getText();var i=this.getView().byId("idOwnedGrp").getSelectedButton().getText();var n=this.getView().byId("goup6CPSR_CS").getSelectedButton().getText();var r=this.getView().byId("idManufacturer_CS").getSelectedKey();var a=this.getView().byId("idModel_CS").getSelectedKey();var c=this.getView().byId("idCC_CS").getSelectedKey();var l=this.getView().byId("idType2_CS").getSelectedKey();var d=this.getView().byId("idSV_CS").getSelectedKey();var u=this.getView().byId("idTypeTO_CS").getSelectedKey();var g=this.getView().byId("idmethod_CS").getSelectedKey();var p=this.getView().byId("idrep_CS").getSelectedKey();var m=this.getView().byId("idBil_CS").getSelectedKey();var S=this.getView().byId("idcomment_CS").getValue();var y=this.getView().byId("idCNpsw_CS").getText();var b=e.cust_name;var f=e.street_name;var h=e.street_no;if(t.connection_object===""||t.connection_object===null||t.connection_object===undefined){t.connection_object=this.getOwnerComponent().getModel("oCustomerAttributesJModel").getData().conn_obj}var C={connection_object:t.connection_object,work_desc:t.work_desc,meter_number:t.meter_number,meter_number2:t.meter_number2,record_status:t.record_status,workflow_id:t.workflow_id,pSNumber:t.pSNumber,completionDate:t.completionDate,fedFrom:t.fedFrom,cableDescription:t.cableDescription,cableFootage:t.cableFootage,ductType:t.ductType,cts:t.cts,pts:t.pts,k:t.k,m:t.m,fusesAt:t.fusesAt,size:t.size,typeCR:t.typeCR,curve:t.curve,voltage:t.voltage,ownedByLBD:s,manufacturer:r,model:a,continuousCurrent:c,loadIntRating:t.loadIntRating,kAMomentaryLBD:t.kAMomentaryLBD,typeLBD:l,faultClosing:t.faultClosing,bilLBD:m,serviceVoltage:d,CycWithstand60:t.CycWithstand60,fuelTypeCB:n,ownedByCB:o,circuitBreakerMake:t.circuitBreakerMake,serialNo:t.serialNo,kAMomentaryCB:t.kAMomentaryCB,amps:t.amps,typeCB:t.typeCB,faultDuty:t.faultDuty,bilCB:t.bilCB,ownedByTransformer:i,ab:t.ab,bc:t.bc,ca:t.ca,an:t.an,bn:t.bn,cn:t.cn,groundMatResistance:t.groundMatResistance,methodUsed:g,dateMergered:t.dateMergered,comment:S,typeofService:t.typeofService,typeofTO:u,pswDiagramNumber:y,primaryServiceRep:p,customerName:b,streetNumber:h,streetName:f,fuses:t.fuses,transformers:t.transformers};console.log(C);return C},getCreateContext_Submit:function(){const e=this.getOwnerComponent().getModel("oCustomerAttributesJModel").getData();var t=this.getOwnerComponent().getModel("oSpecialsjmodel").getData();var s=this.getView().byId("idRadio1_CS").getSelectedButton().getText();var o=this.getView().byId("grop5CPSR_CS").getSelectedButton().getText();var i=this.getView().byId("idOwnedGrp").getSelectedButton().getText();var n=this.getView().byId("goup6CPSR_CS").getSelectedButton().getText();var r=this.getView().byId("idManufacturer_CS").getSelectedKey();var a=this.getView().byId("idModel_CS").getSelectedKey();var c=this.getView().byId("idCC_CS").getSelectedKey();var l=this.getView().byId("idType2_CS").getSelectedKey();var d=this.getView().byId("idSV_CS").getSelectedKey();var u=this.getView().byId("idTypeTO_CS").getSelectedKey();var g=this.getView().byId("idmethod_CS").getSelectedKey();var p=this.getView().byId("idrep_CS").getSelectedKey();var m=this.getView().byId("idBil_CS").getSelectedKey();var S=this.getView().byId("idcomment_CS").getValue();var y=this.getView().byId("idCNpsw_CS").getText();var b=e.cust_name;var f=e.street_name;var h=e.street_no;if(t.connection_object===""||t.connection_object===null||t.connection_object===undefined){t.connection_object=this.getOwnerComponent().getModel("oCustomerAttributesJModel").getData().conn_obj}let C=[];for(let e=0;e<t.fuses.length;e++){var w={fuseSize:t.fuses[e].fuseSize,fuseType:t.fuses[e].fuseType,fuseCurve:t.fuses[e].fuseCurve,fuseVoltage:t.fuses[e].fuseVoltage,fuseSeqNo:t.fuses[e].fuseSeqNo,psospecials_ID:t.fuses[e].psospecials_ID,psospecials_connection_object:t.fuses[e].psospecials_connection_object};C.push(w)}var _=[];for(var v=0;v<t.transformers.length;v++){var I={psospecials_connection_object:t.transformers[v].psospecials_connection_object,psospecials_ID:t.transformers[v].psospecials_ID,transSeqNo:t.transformers[v].transSeqNo,manufacturer:t.transformers[v].manufacturer,imped:t.transformers[v].imped,secVolt:t.transformers[v].secVolt,taps:t.transformers[v].taps,primVolt:t.transformers[v].primVolt,kva:t.transformers[v].kva,serial:t.transformers[v].serial,type:t.transformers[v].type};_.push(I)}var V={connection_object:t.connection_object,work_desc:t.work_desc,meter_number:t.meter_number,meter_number2:t.meter_number2,record_status:t.record_status,workflow_id:t.workflow_id,pSNumber:t.pSNumber,completionDate:t.completionDate,fedFrom:t.fedFrom,cableDescription:t.cableDescription,cableFootage:t.cableFootage,ductType:t.ductType,cts:t.cts,pts:t.pts,k:t.k,m:t.m,fusesAt:t.fusesAt,size:t.size,typeCR:t.typeCR,curve:t.curve,voltage:t.voltage,ownedByLBD:s,manufacturer:r,model:a,continuousCurrent:c,loadIntRating:t.loadIntRating,kAMomentaryLBD:t.kAMomentaryLBD,typeLBD:l,faultClosing:t.faultClosing,bilLBD:m,serviceVoltage:d,CycWithstand60:t.CycWithstand60,fuelTypeCB:n,ownedByCB:o,circuitBreakerMake:t.circuitBreakerMake,serialNo:t.serialNo,kAMomentaryCB:t.kAMomentaryCB,amps:t.amps,typeCB:t.typeCB,faultDuty:t.faultDuty,bilCB:t.bilCB,ownedByTransformer:i,ab:t.ab,bc:t.bc,ca:t.ca,an:t.an,bn:t.bn,cn:t.cn,groundMatResistance:t.groundMatResistance,methodUsed:g,dateMergered:t.dateMergered,comment:S,typeofService:t.typeofService,typeofTO:u,pswDiagramNumber:y,primaryServiceRep:p,customerName:b,streetNumber:h,streetName:f,fuses:C,transformers:_};console.log(V);return V},onBack:function(){window.history.go(-1)},onMeterMatch:function(e){var t=this.getOwnerComponent().getModel("oCustomerAttributesJModel").getData();var o=e.getSource().getValue();if(t.meter1!==o&&t.meter2!==o){s.warning("Meter Number "+o+" entered is not installed at site")}},onAddnewFusesRow:function(e){var t=this.getView().getModel("oSpecialsjmodel");var s=t.getProperty("/fuses")||[];const o=t.getData().connection_object;const i=t.getData().ID;this.sequenceCounter=0;if(s.length===0){this.sequenceCounter=1}else{this.sequenceCounter=s.length;this.sequenceCounter=this.sequenceCounter+1}var n={psospecials_connection_object:o,psospecials_ID:i,fuseSize:"",fuseType:"",fuseVoltage:"",fuseCurve:"",fuseSeqNo:String(this.sequenceCounter).padStart(4,"0")};s.push(n);t.setProperty("/fuses",s)},onAddnewTransRow:function(){var e=this.getView().getModel("oSpecialsjmodel");var t=e.getProperty("/transformers")||[];const s=e.getData().connection_object;const o=e.getData().ID;this.TransSequenceCounter=0;if(t.length===0){this.TransSequenceCounter=1}else{this.TransSequenceCounter=t.length;this.TransSequenceCounter=this.TransSequenceCounter+1}var i={psospecials_connection_object:s,psospecials_ID:o,transSeqNo:String(this.TransSequenceCounter).padStart(4,"0"),manufacturer:"",imped:"",primVolt:"",secVolt:"",taps:"",kva:"",type:"",serial:""};t.push(i);e.setProperty("/transformers",t)}})});
//# sourceMappingURL=CustomerSpecials.controller.js.map