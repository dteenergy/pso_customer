sap.ui.define(["sap/ui/core/mvc/Controller","com/pso/customerattribute/utils/Formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/export/Spreadsheet"],function(e,t,i,r,a,o){"use strict";return e.extend("com.pso.customerattribute.controller.SearchCustomer",{onInit:function(){this.getUserDetails();this.oView=this.getView();this.onActivatingStandardFilter();this.initializBusyIndicator();this.fetchDropdownData()},getUserDetails:async function(){var e=this.getOwnerComponent().getModel();let t=null;var i=e.bindContext("/userDetails(...)");await i.execute().then(function(e){var r=i.getBoundContext().getObject();console.log(r);t=r.value}.bind(this),function(e){console.log(e.message)}.bind(this));this.userScope=t;console.log(this.userScope)},onActivatingStandardFilter:function(){this.applyData=this.applyData.bind(this);this.fetchData=this.fetchData.bind(this);this.oSmartVariantManagement=this.getView().byId("svm");this.oFilterBar=this.getView().byId("_IDGenFilterBar1");this.getFiltersWithValues=this.getFiltersWithValues.bind(this);this.oFilterBar.registerFetchData(this.fetchData);this.oFilterBar.registerApplyData(this.applyData);this.oFilterBar.registerGetFiltersWithValues(this.getFiltersWithValues);var e=new a({type:"filterBar",keyName:"persistencyKey",dataSource:"",control:this.oFilterBar});this.oSmartVariantManagement.addPersonalizableControl(e);this.oSmartVariantManagement.initialise(function(){},this.oFilterBar)},applyData:function(e){e.forEach(function(e){var t=this.oFilterBar.determineControlByName(e.fieldName,e.groupName);t.setValue(e.fieldData)},this)},fetchData:function(){var e=this.oFilterBar.getAllFilterItems().reduce(function(e,t){e.push({groupName:t.getGroupName(),fieldName:t.getName(),fieldData:t.getControl().getValue()});return e},[]);return e},getFiltersWithValues:function(){var e=this.oFilterBar.getFilterGroupItems().reduce(function(e,t){var i=t.getControl();if(i&&i.getValue&&i.getValue().length>0){e.push(t)}return e},[]);return e},initializBusyIndicator:function(){this.oBusyIndicator=0;this.oBusyIndicator=this.oBusyIndicator?this.oBusyIndicator:new sap.m.BusyDialog({text:"",title:"Fetching data..."});return this.oBusyIndicator},fetchDropdownData:function(){var e=this;var t=this.getOwnerComponent().getModel("dropDownJsonModel");this.oBusyIndicator.open();this.getOwnerComponent().getModel("ISUService").read("/DropdownSet",{success:function(i){e.oBusyIndicator.close();if(i.results.length>0){t.setProperty("/DropdownData",i.results)}},error:function(i){e.oBusyIndicator.close();sap.m.MessageBox.show(i.message,{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]});t.setData(oData.results)}})},fetchItems:function(){var e=this;var t=this.oView.getModel("oSearchCustomerJModel");var a=this.oView.byId("idcustomer").getValue();var o=this.oView.byId("idMailingname").getValue();var s=this.oView.byId("idStreetAdd").getValue();var n=this.oView.byId("idStreetNo").getValue();var l=this.oView.byId("idCity").getValue();var u=this.oView.byId("idzipcode").getValue();var d=this.oView.byId("idNoofline").getValue();var p=this.oView.byId("idsrvcenter").getValue();var g=this.oView.byId("idcableno").getValue();var c=this.oView.byId("idPswdigram").getValue();var h=this.oView.byId("idPrimarySRep").getSelectedKey();var m=this.oView.byId("idAcRep").getValue();var y=this.oView.byId("idSubstation").getValue();var w=this.oView.byId("idSrvSketchno").getValue();var F=this.oView.byId("idCircuit").getValue();var b=this.oView.byId("idOnSiteGeneration").getSelectedKey();if(!a&&!o&&!s&&!n&&!l&&!u&&!d&&!p&&!g&&!c&&!h&&!m&&!y&&!w&&!F&&!b){sap.m.MessageBox.show(this.getView().getModel("i18n").getProperty("filter_not_blank"),{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]});return false}var V=[];V.push(new i("cust_name",r.EQ,a));V.push(new i("mail_name",r.EQ,o));V.push(new i("street_name",r.EQ,s));V.push(new i("street_no",r.EQ,n));V.push(new i("city",r.EQ,l));V.push(new i("zip_code",r.EQ,u));V.push(new i("no_of_lines",r.EQ,d));V.push(new i("srv_centre",r.EQ,p));V.push(new i("cable_no",r.EQ,g));V.push(new i("psw",r.EQ,c));V.push(new i("psr",r.EQ,h));V.push(new i("acc_rep",r.EQ,m));V.push(new i("sub_station",r.EQ,y));V.push(new i("sketch_no",r.EQ,w));V.push(new i("circuit",r.EQ,F));V.push(new i("generation",r.EQ,b));this.oBusyIndicator.open();this.getOwnerComponent().getModel("ISUService").read("/Customer_searchSet",{filters:[V],success:function(i){e.oBusyIndicator.close();if(i.results.length>0){e.oView.byId("idNoofRec").setText(i.results.length);t.setProperty("/CustomersData",i.results)}else{t.setData([]);e.oView.byId("idNoofRec").setText(i.results.length)}},error:function(i){e.oBusyIndicator.close();sap.m.MessageBox.show(i.statusText,{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]});t.setData([]);e.oView.byId("idNoofRec").setText("")}})},handleSelectionChange:function(e){var t=e.getSource().getBindingContext("oSearchCustomerJModel").getProperty();var i=this.getOwnerComponent().getModel("oCustomerAttributesJModel");i.setData(t);var r=sap.ui.core.UIComponent.getRouterFor(this);if(t.conn_obj===""){sap.m.MessageBox.show(this.getView().getModel("i18n").getProperty("No_billingEntity_Exist"),{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]})}else{r.navTo("CustomerDetails",{scope:"cd_create"})}},handleTableSearch:function(e){var t=e.getSource().getValue();var a=new i("cust_name",r.Contains,t);var o=new i("mail_name",r.Contains,t);var s=new i("street_name",r.Contains,t);var n=new i("street_no",r.Contains,t);var l=new i("city",r.Contains,t);var u=new i("zip_code",r.Contains,t);var d=new i("no_of_lines",r.Contains,t);var p=new i("srv_centre",r.Contains,t);var g=new i("cable_no",r.Contains,t);var c=new i("sketch_no",r.Contains,t);var h=new i("psw",r.Contains,t);var m=new i("psr",r.Contains,t);var y=new i("acc_rep",r.Contains,t);var w=new i("sub_station",r.Contains,t);var F=new i("circuit",r.Contains,t);var b=new i("conn_obj",r.Contains,t);var V=new i("generation",r.Contains,t);var f=new i([a,o,s,n,l,u,d,p,g,c,h,m,y,w,F,b,V],false);this.oView.byId("idCustomerListTable").getBinding("items").filter([f])},onTableColumnFilterButtonPress:function(){var e=this.oView.getModel("oSearchCustomerJModel");var t=e.getProperty("/CustomersData");if(t.length>0){if(!this._oColumnFilterDialog){this._oColumnFilterDialog=sap.ui.xmlfragment("idColumnFiltersFrag","com.pso.customerattribute.fragment.ColumnFilters",this);this.getView().addDependent(this._oColumnFilterDialog)}sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCustName").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragMailingName").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragBillingentity").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragStreetAdd").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragStreetNo").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idFragCity").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragZipcode").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragNoofLines").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSrvCenter").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCableNo").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragpswdigram").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragPrimerySrvRep").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragAccRep").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSubstation").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSketchNo").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCircuit").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragGeneration").setValue("");this._oColumnFilterDialog.open()}},onValidReportsColumnFilterConfirm:function(){var e=this.getView().byId("idCustomerListTable");var t=e.getBinding("items");var a=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCustName").getValue(),o=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragMailingName").getValue(),s=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragBillingentity").getValue(),n=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragStreetAdd").getValue(),l=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragStreetNo").getValue(),u=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idFragCity").getValue(),d=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragZipcode").getValue(),p=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragNoofLines").getValue(),g=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSrvCenter").getValue(),c=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCableNo").getValue(),h=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragpswdigram").getValue(),m=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragPrimerySrvRep").getValue(),y=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragAccRep").getValue(),w=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSubstation").getValue(),F=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSketchNo").getValue(),b=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCircuit").getValue(),V=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragGeneration").getValue();if(a===""&&o===""&&s===""&&n===""&&l===""&&u===""&&d===""&&p===""&&g===""&&c===""&&h===""&&m===""&&y===""&&w===""&&F===""&&b===""&&V===""){t.filter([])}else{var f=[];if(a!==""){f.push(new i("cust_name",r.EQ,a))}if(o!==""){f.push(new i("mail_name",r.EQ,o))}if(s!==""){f.push(new i("conn_obj",r.EQ,s))}if(n!==""){f.push(new i("street_name",r.EQ,n))}if(l!==""){f.push(new i("street_no",r.EQ,l))}if(u!==""){f.push(new i("city",r.EQ,u))}if(d!==""){f.push(new i("zip_code",r.EQ,d))}if(p!==""){f.push(new i("no_of_lines",r.EQ,p))}if(g!==""){f.push(new i("srv_centre",r.EQ,g))}if(c!==""){f.push(new i("cable_no",r.EQ,c))}if(h!==""){f.push(new i("psw",r.EQ,h))}if(m!==""){f.push(new i("psr",r.EQ,m))}if(y!==""){f.push(new i("acc_rep",r.EQ,y))}if(w!==""){f.push(new i("sub_station",r.EQ,w))}if(F!==""){f.push(new i("sketch_no",r.EQ,F))}if(b!==""){f.push(new i("circuit",r.EQ,b))}if(V!==""){f.push(new i("generation",r.EQ,V))}var C=new i(f,true);t.filter(C)}},onValidReportsColumnFilterCancel:function(){var e=this.getView().byId("idCustomerListTable");var t=e.getBinding("items");t.filter([])},onValidReportsColumnFilterRemove:function(){var e=this.getView().byId("idCustomerListTable");var t=e.getBinding("items");t.filter([])},onValidReportsTableSorting:function(e){this._getValidReportsTableSortDialog().open()},_getValidReportsTableSortDialog:function(){var e=this.oView.getModel("oSearchCustomerJModel");if(!this._oValidReportsTableSortDialog){this._oValidReportsTableSortDialog=sap.ui.xmlfragment(this.createId("idValidReportsTableSortFrag"),"com.pso.customerattribute.fragment.TableSort",this);this.getView().addDependent(this._oValidReportsTableSortDialog)}return this._oValidReportsTableSortDialog},onTableSortConfirm:function(e){var t=e.getParameter("sortItem").getKey(),i=e.getParameter("sortDescending");var r=this.getView().byId("idCustomerListTable"),a=this.getView().byId("idTableSort");this._oValidReportsTableSortSelection={path:t,desc:i};a.setType("Emphasized");var o=new sap.ui.model.Sorter(this._oValidReportsTableSortSelection.path,this._oValidReportsTableSortSelection.desc);r.getBinding("items").sort(o)},onValidReportsTableExport:function(){var e,t,i,r,a;var s=this.oView.getModel("oSearchCustomerJModel");var t=s.getProperty("/CustomersData");var n=this.getResourceBundle();a=n.getText("customerReport");if(t.length>0){e=this.getColumnConfig(n);i={workbook:{columns:e},dataSource:t,fileName:a+".xlsx",worker:true,sheetName:"Customer Records",metaSheetName:"Customer Records",title:"Customer Records",application:"Records"};r=new o(i);r.build().finally(function(){r.destroy()})}},getColumnConfig:function(e){var t=[];t.push({label:e.getText("Fcutname"),type:sap.ui.export.EdmType.String,property:"cust_name",width:20,wrap:true});t.push({label:e.getText("FMailingname"),type:sap.ui.export.EdmType.String,property:"mail_name",width:20,wrap:true});t.push({label:e.getText("FBillingEntity"),type:sap.ui.export.EdmType.String,property:"conn_obj",width:20,wrap:true});t.push({label:e.getText("FStreetAdd"),type:sap.ui.export.EdmType.String,property:"street_name",width:20,wrap:true});t.push({label:e.getText("FStreetNo"),type:sap.ui.export.EdmType.String,property:"street_no",width:20,wrap:true});t.push({label:e.getText("Fcity"),type:sap.ui.export.EdmType.String,property:"city",width:20,wrap:true});t.push({label:e.getText("FZipcod"),type:sap.ui.export.EdmType.String,property:"zip_code",width:20,wrap:true});t.push({label:e.getText("FNumberoflines"),type:sap.ui.export.EdmType.String,property:"no_of_lines",width:20,wrap:true});t.push({label:e.getText("Fsrvcenter"),type:sap.ui.export.EdmType.String,property:"srv_centre",width:20,wrap:true});t.push({label:e.getText("Fcableno"),type:sap.ui.export.EdmType.String,property:"cable_no",width:20,wrap:true});t.push({label:e.getText("Fsrvsktchno"),type:sap.ui.export.EdmType.String,property:"sketch_no",width:20,wrap:true});t.push({label:e.getText("Fpswidigram"),type:sap.ui.export.EdmType.String,property:"psw",width:20,wrap:true});t.push({label:e.getText("Fprimeryrvrep"),type:sap.ui.export.EdmType.String,property:"psr",width:20,wrap:true});t.push({label:e.getText("Faccountrp"),type:sap.ui.export.EdmType.String,property:"acc_rep",width:20,wrap:true});t.push({label:e.getText("Fsustatoin"),type:sap.ui.export.EdmType.String,property:"sub_station",width:20,wrap:true});t.push({label:e.getText("Fcircuit"),type:sap.ui.export.EdmType.String,property:"circuit",width:20,wrap:true});t.push({label:e.getText("FOnSiteGeneration"),type:sap.ui.export.EdmType.String,property:"generation",width:20,wrap:true});return t},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},onClear:function(){var e=this.getOwnerComponent().getModel("oSearchCustomerJModel");e.setProperty("/CustomersData",[]);this.oView.byId("idcustomer").setValue();this.oView.byId("idMailingname").setValue();this.oView.byId("idStreetAdd").setValue();this.oView.byId("idStreetNo").setValue();this.oView.byId("idCity").setValue();this.oView.byId("idzipcode").setValue();this.oView.byId("idNoofline").setValue();this.oView.byId("idsrvcenter").setValue();this.oView.byId("idcableno").setValue();this.oView.byId("idPswdigram").setValue();this.oView.byId("idPrimarySRep").setSelectedKey();this.oView.byId("idAcRep").setValue();this.oView.byId("idSubstation").setValue();this.oView.byId("idSrvSketchno").setValue();this.oView.byId("idCircuit").setValue();this.oView.byId("idOnSiteGeneration").setSelectedKey();this.oView.byId("idNoofRec").setText("0")},onCapitalizeFirtsLater:function(e){var t=e.getSource();var i=t.getValue();var r=this.capitalizeFirstLetterOfEachWord(i);t.setValue(r)},capitalizeFirstLetterOfEachWord:function(e){return e.replace(/\b\w/g,function(e){return e.toUpperCase()})}})});
//# sourceMappingURL=SearchCustomer.controller.js.map