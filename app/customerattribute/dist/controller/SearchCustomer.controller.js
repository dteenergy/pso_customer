sap.ui.define(["sap/ui/core/mvc/Controller","com/pso/customerattribute/utils/Formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/export/Spreadsheet"],function(e,t,i,r,a,s){"use strict";return e.extend("com.pso.customerattribute.controller.SearchCustomer",{onInit:function(){this.hasRecordCreateAccess=false;this.getUserDetails();this.onActivatingStandardFilter();this.initializBusyIndicator();this.fetchDropdownData()},getUserDetails:async function(){let e=this.getOwnerComponent().getModel("oUserScopeJModel");e.setData("");let t=this.getOwnerComponent().getModel();let i=t.bindContext("/userDetails(...)");try{await i.execute().then(function(t){let r=i.getBoundContext().getObject();console.log(r);if(r){e.setData(r)}else{}}.bind(this),function(e){let t=e.message+"\nPSO Roles not found! Contact support admin!";sap.m.MessageBox.error(e.message);console.error(e.message)}.bind(this))}catch(e){console.error(e)}},onActivatingStandardFilter:function(){this.applyData=this.applyData.bind(this);this.fetchData=this.fetchData.bind(this);this.oSmartVariantManagement=this.getView().byId("svm");this.oFilterBar=this.getView().byId("_IDGenFilterBar1");this.getFiltersWithValues=this.getFiltersWithValues.bind(this);this.oFilterBar.registerFetchData(this.fetchData);this.oFilterBar.registerApplyData(this.applyData);this.oFilterBar.registerGetFiltersWithValues(this.getFiltersWithValues);var e=new a({type:"filterBar",keyName:"persistencyKey",dataSource:"",control:this.oFilterBar});this.oSmartVariantManagement.addPersonalizableControl(e);this.oSmartVariantManagement.initialise(function(){},this.oFilterBar)},applyData:function(e){e.forEach(function(e){var t=this.oFilterBar.determineControlByName(e.fieldName,e.groupName);t.setValue(e.fieldData)},this)},fetchData:function(){var e=this.oFilterBar.getAllFilterItems().reduce(function(e,t){e.push({groupName:t.getGroupName(),fieldName:t.getName(),fieldData:t.getControl().getValue()});return e},[]);return e},getFiltersWithValues:function(){var e=this.oFilterBar.getFilterGroupItems().reduce(function(e,t){var i=t.getControl();if(i&&i.getValue&&i.getValue().length>0){e.push(t)}return e},[]);return e},initializBusyIndicator:function(){this.oBusyIndicator=0;this.oBusyIndicator=this.oBusyIndicator?this.oBusyIndicator:new sap.m.BusyDialog({text:"",title:""});return this.oBusyIndicator},fetchDropdownData:function(){var e=this;var t=this.getOwnerComponent().getModel("dropDownJsonModel");this.oBusyIndicator.open();this.getOwnerComponent().getModel("ISUService").read("/DropdownSet",{success:function(i){e.oBusyIndicator.close();if(i.results.length>0){t.setProperty("/DropdownData",i.results)}},error:function(i){e.oBusyIndicator.close();sap.m.MessageBox.show(i.message,{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]});t.setData(oData.results)}})},fetchItems:function(){let e=this.getOwnerComponent().getModel("oUserScopeJModel").getData();if(!e.hasSearchAccess){sap.m.MessageBox.show(this.getView().getModel("i18n").getProperty("no_search_access"),{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]});return}var t=this;var a=this.getView().getModel("oSearchCustomerJModel");var s=this.getView().byId("idcustomer").getValue();var o=this.getView().byId("idMailingname").getValue();var n=this.getView().byId("idStreetAdd").getValue();var l=this.getView().byId("idStreetNo").getValue();var u=this.getView().byId("idCity").getValue();var g=this.getView().byId("idzipcode").getValue();var d=this.getView().byId("idNoofline").getValue();var p=this.getView().byId("idsrvcenter").getValue();var c=this.getView().byId("idcableno").getValue();var h=this.getView().byId("idPswdigram").getValue();var m=this.getView().byId("idPrimarySRep").getSelectedKey();var y=this.getView().byId("idAcRep").getValue();var w=this.getView().byId("idSubstation").getValue();var F=this.getView().byId("idSrvSketchno").getValue();var b=this.getView().byId("idCircuit").getValue();var f=this.getView().byId("idOnSiteGeneration").getSelectedKey();if(!s&&!o&&!n&&!l&&!u&&!g&&!d&&!p&&!c&&!h&&!m&&!y&&!w&&!F&&!b&&!f){sap.m.MessageBox.show(this.getView().getModel("i18n").getProperty("filter_not_blank"),{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]});return false}var V=[];V.push(new i("cust_name",r.EQ,s));V.push(new i("mail_name",r.EQ,o));V.push(new i("street_name",r.EQ,n));V.push(new i("street_no",r.EQ,l));V.push(new i("city",r.EQ,u));V.push(new i("zip_code",r.EQ,g));V.push(new i("no_of_lines",r.EQ,d));V.push(new i("srv_centre",r.EQ,p));V.push(new i("cable_no",r.EQ,c));V.push(new i("psw",r.EQ,h));V.push(new i("psr",r.EQ,m));V.push(new i("acc_rep",r.EQ,y));V.push(new i("sub_station",r.EQ,w));V.push(new i("sketch_no",r.EQ,F));V.push(new i("circuit",r.EQ,b));V.push(new i("generation",r.EQ,f));this.oBusyIndicator.open();try{this.getOwnerComponent().getModel("ISUService").read("/Customer_searchSet",{filters:[V],success:function(e){t.oBusyIndicator.close();var i=false;if(e.results.length>0){t.oView.byId("idNoofRec").setText(e.results.length);a.setProperty("/CustomersData",e.results)}else{i=true}if(i){a.setData([]);t.oView.byId("idNoofRec").setText(e.results.length)}},error:function(e){t.oBusyIndicator.close();sap.m.MessageBox.show(e.statusText,{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]});a.setData([]);t.oView.byId("idNoofRec").setText("")}})}catch{}},handleSelectionChange:function(e){let t=this.getOwnerComponent().getModel("oUserScopeJModel").getData();var i=e.getSource().getBindingContext("oSearchCustomerJModel").getProperty();var r=this.getOwnerComponent().getModel("oCustomerAttributesJModel");r.setData(i);var a=sap.ui.core.UIComponent.getRouterFor(this);if(i.conn_obj===""){sap.m.MessageBox.show(this.getView().getModel("i18n").getProperty("No_billingEntity_Exist"),{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]})}else{if(!t.hasCustomerCreateAccess&&i.superior_flag==="X"){sap.m.MessageBox.show(this.getView().getModel("i18n").getProperty("superior_restricted"),{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]})}else{a.navTo("CustomerDetails",{scope:"cd_create"})}}},handleTableSearch:function(e){var t=e.getSource().getValue();var a=new i("cust_name",r.Contains,t);var s=new i("mail_name",r.Contains,t);var o=new i("street_name",r.Contains,t);var n=new i("street_no",r.Contains,t);var l=new i("city",r.Contains,t);var u=new i("zip_code",r.Contains,t);var g=new i("no_of_lines",r.Contains,t);var d=new i("srv_centre",r.Contains,t);var p=new i("cable_no",r.Contains,t);var c=new i("sketch_no",r.Contains,t);var h=new i("psw",r.Contains,t);var m=new i("psr",r.Contains,t);var y=new i("acc_rep",r.Contains,t);var w=new i("sub_station",r.Contains,t);var F=new i("circuit",r.Contains,t);var b=new i("conn_obj",r.Contains,t);var f=new i("generation",r.Contains,t);var V=new i([a,s,o,n,l,u,g,d,p,c,h,m,y,w,F,b,f],false);this.getView().byId("idCustomerListTable").getBinding("items").filter([V])},onTableColumnFilterButtonPress:function(){var e=this.getView().getModel("oSearchCustomerJModel");var t=e.getProperty("/CustomersData");if(t.length>0){if(!this._oColumnFilterDialog){this._oColumnFilterDialog=sap.ui.xmlfragment("idColumnFiltersFrag","com.pso.customerattribute.fragment.ColumnFilters",this);this.getView().addDependent(this._oColumnFilterDialog)}sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCustName").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragMailingName").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragBillingentity").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragStreetAdd").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragStreetNo").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idFragCity").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragZipcode").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragNoofLines").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSrvCenter").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCableNo").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragpswdigram").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragPrimerySrvRep").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragAccRep").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSubstation").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSketchNo").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCircuit").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragGeneration").setValue("");this._oColumnFilterDialog.open()}},onValidReportsColumnFilterConfirm:function(){var e=this.getView().byId("idCustomerListTable");var t=e.getBinding("items");var a=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCustName").getValue(),s=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragMailingName").getValue(),o=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragBillingentity").getValue(),n=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragStreetAdd").getValue(),l=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragStreetNo").getValue(),u=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idFragCity").getValue(),g=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragZipcode").getValue(),d=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragNoofLines").getValue(),p=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSrvCenter").getValue(),c=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCableNo").getValue(),h=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragpswdigram").getValue(),m=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragPrimerySrvRep").getValue(),y=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragAccRep").getValue(),w=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSubstation").getValue(),F=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSketchNo").getValue(),b=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCircuit").getValue(),f=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragGeneration").getValue();if(a===""&&s===""&&o===""&&n===""&&l===""&&u===""&&g===""&&d===""&&p===""&&c===""&&h===""&&m===""&&y===""&&w===""&&F===""&&b===""&&f===""){t.filter([])}else{var V=[];if(a!==""){V.push(new i("cust_name",r.EQ,a))}if(s!==""){V.push(new i("mail_name",r.EQ,s))}if(o!==""){V.push(new i("conn_obj",r.EQ,o))}if(n!==""){V.push(new i("street_name",r.EQ,n))}if(l!==""){V.push(new i("street_no",r.EQ,l))}if(u!==""){V.push(new i("city",r.EQ,u))}if(g!==""){V.push(new i("zip_code",r.EQ,g))}if(d!==""){V.push(new i("no_of_lines",r.EQ,d))}if(p!==""){V.push(new i("srv_centre",r.EQ,p))}if(c!==""){V.push(new i("cable_no",r.EQ,c))}if(h!==""){V.push(new i("psw",r.EQ,h))}if(m!==""){V.push(new i("psr",r.EQ,m))}if(y!==""){V.push(new i("acc_rep",r.EQ,y))}if(w!==""){V.push(new i("sub_station",r.EQ,w))}if(F!==""){V.push(new i("sketch_no",r.EQ,F))}if(b!==""){V.push(new i("circuit",r.EQ,b))}if(f!==""){V.push(new i("generation",r.EQ,f))}var C=new i(V,true);t.filter(C)}},onValidReportsColumnFilterCancel:function(){var e=this.getView().byId("idCustomerListTable");var t=e.getBinding("items");t.filter([])},onValidReportsColumnFilterRemove:function(){var e=this.getView().byId("idCustomerListTable");var t=e.getBinding("items");t.filter([])},onValidReportsTableSorting:function(e){this._getValidReportsTableSortDialog().open()},_getValidReportsTableSortDialog:function(){var e=this.getView().getModel("oSearchCustomerJModel");if(!this._oValidReportsTableSortDialog){this._oValidReportsTableSortDialog=sap.ui.xmlfragment(this.createId("idValidReportsTableSortFrag"),"com.pso.customerattribute.fragment.TableSort",this);this.getView().addDependent(this._oValidReportsTableSortDialog)}return this._oValidReportsTableSortDialog},onTableSortConfirm:function(e){var t=e.getParameter("sortItem").getKey(),i=e.getParameter("sortDescending");var r=this.getView().byId("idCustomerListTable"),a=this.getView().byId("idTableSort");this._oValidReportsTableSortSelection={path:t,desc:i};a.setType("Emphasized");var s=new sap.ui.model.Sorter(this._oValidReportsTableSortSelection.path,this._oValidReportsTableSortSelection.desc);r.getBinding("items").sort(s)},onValidReportsTableExport:function(){var e,t,i,r,a;var o=this.getView().getModel("oSearchCustomerJModel");var t=o.getProperty("/CustomersData");var n=this.getResourceBundle();a=n.getText("customerReport");if(t.length>0){e=this.getColumnConfig(n);i={workbook:{columns:e},dataSource:t,fileName:a+".xlsx",worker:true,sheetName:"Customer Records",metaSheetName:"Customer Records",title:"Customer Records",application:"Records"};r=new s(i);r.build().finally(function(){r.destroy()})}},getColumnConfig:function(e){var t=[];t.push({label:e.getText("Fcutname"),type:sap.ui.export.EdmType.String,property:"cust_name",width:20,wrap:true});t.push({label:e.getText("FMailingname"),type:sap.ui.export.EdmType.String,property:"mail_name",width:20,wrap:true});t.push({label:e.getText("FBillingEntity"),type:sap.ui.export.EdmType.String,property:"conn_obj",width:20,wrap:true});t.push({label:e.getText("FStreetAdd"),type:sap.ui.export.EdmType.String,property:"street_name",width:20,wrap:true});t.push({label:e.getText("FStreetNo"),type:sap.ui.export.EdmType.String,property:"street_no",width:20,wrap:true});t.push({label:e.getText("Fcity"),type:sap.ui.export.EdmType.String,property:"city",width:20,wrap:true});t.push({label:e.getText("FZipcod"),type:sap.ui.export.EdmType.String,property:"zip_code",width:20,wrap:true});t.push({label:e.getText("FNumberoflines"),type:sap.ui.export.EdmType.String,property:"no_of_lines",width:20,wrap:true});t.push({label:e.getText("Fsrvcenter"),type:sap.ui.export.EdmType.String,property:"srv_centre",width:20,wrap:true});t.push({label:e.getText("Fcableno"),type:sap.ui.export.EdmType.String,property:"cable_no",width:20,wrap:true});t.push({label:e.getText("Fsrvsktchno"),type:sap.ui.export.EdmType.String,property:"sketch_no",width:20,wrap:true});t.push({label:e.getText("Fpswidigram"),type:sap.ui.export.EdmType.String,property:"psw",width:20,wrap:true});t.push({label:e.getText("Fprimeryrvrep"),type:sap.ui.export.EdmType.String,property:"psr",width:20,wrap:true});t.push({label:e.getText("Faccountrp"),type:sap.ui.export.EdmType.String,property:"acc_rep",width:20,wrap:true});t.push({label:e.getText("Fsustatoin"),type:sap.ui.export.EdmType.String,property:"sub_station",width:20,wrap:true});t.push({label:e.getText("Fcircuit"),type:sap.ui.export.EdmType.String,property:"circuit",width:20,wrap:true});t.push({label:e.getText("FOnSiteGeneration"),type:sap.ui.export.EdmType.String,property:"generation",width:20,wrap:true});t.push({label:e.getText("FTotal_Gen"),type:sap.ui.export.EdmType.String,property:"total_gen",width:20,wrap:true});return t},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},onClear:function(){var e=this.getOwnerComponent().getModel("oSearchCustomerJModel");e.setProperty("/CustomersData",[]);this.getView().byId("idcustomer").setValue();this.getView().byId("idMailingname").setValue();this.getView().byId("idStreetAdd").setValue();this.getView().byId("idStreetNo").setValue();this.getView().byId("idCity").setValue();this.getView().byId("idzipcode").setValue();this.getView().byId("idNoofline").setValue();this.getView().byId("idsrvcenter").setValue();this.getView().byId("idcableno").setValue();this.getView().byId("idPswdigram").setValue();this.getView().byId("idPrimarySRep").setSelectedKey();this.getView().byId("idAcRep").setValue();this.getView().byId("idSubstation").setValue();this.getView().byId("idSrvSketchno").setValue();this.getView().byId("idCircuit").setValue();this.getView().byId("idOnSiteGeneration").setSelectedKey();this.getView().byId("idNoofRec").setText("0")},onCapitalizeFirtsLater:function(e){var t=e.getSource();var i=t.getValue();var r=this.capitalizeFirstLetterOfEachWord(i);t.setValue(r)},capitalizeFirstLetterOfEachWord:function(e){return e.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")}})});
//# sourceMappingURL=SearchCustomer.controller.js.map