sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/model/Filter"],function(e,t,o){"use strict";return e.extend("com.pso.changelog.controller.filterinterface",{onInit:function(){this.model=this.getOwnerComponent().getModel();this.localModel=this.getOwnerComponent().getModel("localModel");this.localModel.setProperty("/tableItemsCount",`Items(0)`);this.readApprByVH();this.checkAuth()},checkAuth:function(){let e=this.getOwnerComponent().getModel().bindContext("/userDetails(...)");var t=this;e.execute().then(o=>{let n=e.getBoundContext().getObject();if(n.hasCustomerDisplayAccess&n.hasSpecialsDisplayAccess){t.localModel.setProperty("/filterVisible",{apprvBy:false,recrdStats:false})}else{t.localModel.setProperty("/filterVisible",{apprvBy:true,recrdStats:true})}})},filterVH:function(e,t){let o=this.model.bindList("/PSOSpecials",undefined,undefined,e);let n={dataToDisplay:[]};let i={dataToDisplay:[]};o.requestContexts(0,Infinity).then(function(e){e.forEach(e=>{let t=e.getObject()["approvedBy"];if(!n.hasOwnProperty(t)){n[t]=e.getObject()["approvedBy"];n["dataToDisplay"].push({approvedBy:t})}let o=e.getObject()["connection_object"];if(!i.hasOwnProperty(o)){i[o]=e.getObject()["connection_object"];i["dataToDisplay"].push({connection_object:o})}});this.localModel.refresh(true)}.bind(this));if(t=="approvedBy"){this.localModel.setProperty("/connectionObjVH",i.dataToDisplay)}else if(t=="connection_object"){this.localModel.setProperty("/approvedByVH",n.dataToDisplay)}},readApprByVH:function(e){let t=this.model.bindList("/PSOSpecials",undefined,undefined,e);let o=[];let n={dataToDisplay:[]};let i={dataToDisplay:[]};let a={dataToDisplay:[]};t.requestContexts(0,Infinity).then(function(t){t.forEach(e=>{let t=e.getObject();t.createdAt=new Date(t.createdAt).toLocaleString();o.push(t);let l=e.getObject()["approvedBy"];if(!n.hasOwnProperty(l)){n[l]=e.getObject()["approvedBy"];n["dataToDisplay"].push({approvedBy:l})}let s=e.getObject()["connection_object"];if(!i.hasOwnProperty(s)){i[s]=e.getObject()["connection_object"];i["dataToDisplay"].push({connection_object:s})}let r=e.getObject()["record_status"];if(!a.hasOwnProperty(r.toLowerCase())&&r!==null){a[r.toLowerCase()]=e.getObject()["record_status"].toLowerCase();a["dataToDisplay"].push({key:r,text:r.replace(/^./,r[0].toUpperCase())})}});if(!e){this.localModel.setProperty("/approvedByVH",n.dataToDisplay);this.localModel.setProperty("/connectionObjVH",i.dataToDisplay);this.localModel.setProperty("/recordStatsVH",a.dataToDisplay)}else{this.localModel.setProperty("/tableItemsCount",`Items(${o.length})`);this.localModel.setProperty("/PSOSpecials",o);this.byId("idTable").setBusy(false)}this.localModel.refresh(true)}.bind(this))},onBasicSearch:async function(e){let t=this.byId(this._tokensForInput).getParent().getName();if(t=="approvedBy"){let n=await this.apprDialog.getTableAsync();if(n.bindRows){n.getBinding("rows").filter(new o(this.byId(t,"Contains",e.getParameter("newValue"))))}else if(n.bindItems){n.getBinding("items").filter(new o(this.byId(t,"Contains",e.getParameter("newValue"))))}}else if(t=="connection_object"){let n=await this.conObjDialog.getTableAsync();if(n.bindRows){n.getBinding("rows").filter(new o(t,"Contains",e.getParameter("newValue")))}else if(n.bindItems){n.getBinding("items").filter(new o(t,"Contains",e.getParameter("newValue")))}}},onValueHelpApprovedBy:function(e){this._tokensForInput=e.getSource().getId();let n=this.byId("idConnObj").getTokens();if(n.length>0){let e=[];n.forEach(t=>{e.push(new o(this.byId("idConnObj").getParent().getName(),"EQ",t.getKey()))});this.filterVH(e,this.byId("idConnObj").getParent().getName())}else{this.readApprByVH()}var i=this;if(!this.apprDialog){t.load({name:"com.pso.changelog.fragments.approvedby",type:"XML",controller:this}).then(e=>{e.setModel(this.localModel);this.apprDialog=e;this.getView().addDependent(this.apprDialog);this.apprDialog.getFilterBar().setBasicSearch(new sap.m.SearchField({liveChange:[i.onBasicSearch,i],value:"{localModel>/basicSearch}",showSearchButton:true}));this.apprDialog.getTableAsync().then(t=>{t.setModel(i.localModel);if(t.bindRows){t.removeAllExtension();t.attachRowSelectionChange(function(e){this.onValueHelpOkPress()}.bind(this));t.setSelectionMode("Single");t.bindAggregation("rows",{path:"/approvedByVH",events:{dataReceived:function(){e.update()}}})}t.addColumn(new sap.ui.table.Column({label:"Approved By",template:new sap.m.Text({text:"{approvedBy}"})}));if(t.bindItems){t.setMode("SingleSelect");t.bindAggregation("items",{path:"/approvedByVH",template:new sap.m.ColumnListItem({cells:[new sap.m.Label({text:"{approvedBy}"})]}),events:{dataReceived:function(){e.update()}}});t.addColumn(new sap.m.Column({header:new sap.m.Label({text:"Approved By"})}))}});e.update();sap.ui.getCore().byId("idVhStoreDialog-tokenizerGrid").setVisible(false);this.apprDialog.open()})}else{this.apprDialog.open()}},onValueHelpConnObj:function(e){this._tokensForInput=e.getSource().getId();let n=this.byId("idApprBy").getTokens();if(n.length>0){let e=[];n.forEach(t=>{e.push(new o(this.byId("idApprBy").getParent().getName(),"EQ",t.getKey()))});this.filterVH(e,this.byId("idApprBy").getParent().getName())}else{this.readApprByVH()}if(!this.conObjDialog){t.load({name:"com.pso.changelog.fragments.connecObj",type:"XML",controller:this}).then(e=>{e.setModel(this.localModel);this.conObjDialog=e;this.getView().addDependent(this.conObjDialog);var t=this;this.conObjDialog.getFilterBar().setBasicSearch(new sap.m.SearchField({liveChange:[t.onBasicSearch,t],value:"{localModel>/basicSearch}",showSearchButton:true}));this.conObjDialog.getTableAsync().then(o=>{o.setModel(t.localModel);if(o.bindRows){o.removeAllExtension();o.attachRowSelectionChange(function(e){this.onValueHelpOkPress()}.bind(this));o.setSelectionMode("Single");o.bindAggregation("rows",{path:"/connectionObjVH",events:{dataReceived:function(){e.update()}}})}o.addColumn(new sap.ui.table.Column({label:"Connection Object",template:new sap.m.Text({text:"{connection_object}"})}));if(o.bindItems){o.setMode("SingleSelect");o.bindAggregation("items",{path:"/connectionObjVH",template:new sap.m.ColumnListItem({cells:[new sap.m.Label({text:"{connection_object}"})]}),events:{dataReceived:function(){e.update()}}});o.addColumn(new sap.m.Column({header:new sap.m.Label({text:"Connection Object"})}))}});e.update();sap.ui.getCore().byId("idVhConObjDialog-tokenizerGrid").setVisible(false);this.conObjDialog.open()})}else{this.conObjDialog.open()}},onValueHelpCancelPress:function(e){this._tokensForInput=undefined;e.getSource().close()},onValueHelpOkPress:function(e){if(this._tokensForInput!==undefined){if(e!=undefined){this.byId(this._tokensForInput).setTokens(e.getSource()._getTokenizer().getTokens());e.getSource().close();this._tokensForInput=undefined}else{let e;if(this._tokensForInput.includes("idConnObj")){e=this.conObjDialog}else{e=this.apprDialog}this.byId(this._tokensForInput).setTokens(e._getTokenizer().getTokens());e.close();if(e.getTable().getSelectedIndex()!=-1){this._tokensForInput=undefined}}}},onRowSelect:function(e){this.getOwnerComponent().getModel("localModel").setProperty("/selectedItem",e.getParameters().listItem.getBindingContext("localModel").getObject());this.getOwnerComponent().getRouter().navTo("RoutedetailPage",{ID:e.getParameters().listItem.getBindingContext("localModel").getObject().ID,connection_object:e.getParameters().listItem.getBindingContext("localModel").getObject().connection_object})},onFilterBarClear:function(e){e.mParameters.selectionSet.forEach(e=>{if(e.getMetadata().getName().toLowerCase().includes("multiinput")){e.removeAllTokens()}else if(e.getMetadata().getName().toLowerCase().includes("select")){e.setSelectedKey("approved")}});this.byId("idFilterBar").fireSearch({firedFromFilterBar:true,selectionSet:e.getParameters().selectionSet})},onFilterBarSearch:function(e){this.byId("idTable").setBusy(true);let t=[];e.getParameter("selectionSet").forEach(e=>{if(!e.getMetadata().getName().toLowerCase().includes("select")){e.getTokens().forEach(n=>{t.push(new o(e.getParent().getName(),"EQ",n.getKey()))})}else{t.push(new o(e.getParent().getName(),"EQ",e.getSelectedItem().getKey()))}});this.readApprByVH(t);this.byId("idTable").setShowOverlay(false)},onTokenUpdate:function(e){let t;if(e.getParameter("type")=="removed"){t=e.getSource().getTokens().length-1}if(t==0){if(e.getSource().getParent().getName()=="approvedBy"){if(this.apprDialog){this.apprDialog._getTokenizer().removeAllTokens();let e=this.apprDialog.getTable().getSelectedIndices().sort();this.apprDialog.getTable().removeSelectionInterval(e[0],e[e.length-1]);this.apprDialog.getTable()._updateSelection()}}if(e.getSource().getParent().getName()=="connection_object"){if(this.conObjDialog){this.conObjDialog._getTokenizer().removeAllTokens();let e=this.conObjDialog.getTable().getSelectedIndices().sort();this.conObjDialog.getTable().removeSelectionInterval(e[0],e[e.length-1]);this.conObjDialog.getTable()._updateSelection()}}}}})});
//# sourceMappingURL=filterinterface.controller.js.map