sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/export/Spreadsheet","sap/ui/export/library","sap/ui/model/Sorter"],function(e,t,o,a,i,n){"use strict";return e.extend("com.pso.changelog.controller.filterinterface",{onInit:function(){this.model=this.getOwnerComponent().getModel();this.localModel=this.getOwnerComponent().getModel("localModel");this.localModel.setProperty("/tableItemsCount",`Items(0)`);this.readApprByVH()},EdmType:i.EdmType,checkAuth:function(){let e=this.getOwnerComponent().getModel().bindContext("/userDetails(...)");var t=this;e.execute().then(o=>{let a=e.getBoundContext().getObject();if(a.hasCustomerDisplayAccess&a.hasSpecialsDisplayAccess){t.localModel.setProperty("/filterVisible",{apprvBy:false,recrdStats:false})}else{t.localModel.setProperty("/filterVisible",{apprvBy:true,recrdStats:true})}})},filterVH:function(e,t){let o=this.model.bindList("/PSOSpecials",undefined,undefined,e);let a={dataToDisplay:[]};let i={dataToDisplay:[]};o.requestContexts(0,Infinity).then(function(e){e.forEach(e=>{let t=e.getObject()["approvedBy"];if(!a.hasOwnProperty(t)){a[t]=e.getObject()["approvedBy"];a["dataToDisplay"].push({approvedBy:t})}let o=e.getObject()["connection_object"];if(!i.hasOwnProperty(o)){i[o]=e.getObject()["connection_object"];i["dataToDisplay"].push({connection_object:o})}});this.localModel.refresh(true)}.bind(this));if(t=="approvedBy"){this.localModel.setProperty("/connectionObjVH",i.dataToDisplay)}else if(t=="connection_object"){this.localModel.setProperty("/approvedByVH",a.dataToDisplay)}},readApprByVH:function(e,t){let o=this.model.bindList("/PSOSpecials",undefined,undefined,e);if(t){o.sort(t)}let a=[];let i={dataToDisplay:[]};let n={dataToDisplay:[]};let s={dataToDisplay:[{key:"All",text:"All"}]};let l={dataToDisplay:[]};let r={dataToDisplay:[]};let d={dataToDisplay:[]};o.requestContexts(0,Infinity).then(function(t){t.forEach(e=>{let t=e.getObject();t.createdAt=t.createdAt!=null?new Date(t.createdAt).toLocaleString():t.createdAt;t.approvedOn=t.approvedOn!=null?new Date(t.approvedOn).toLocaleString():t.approvedOn;a.push(t);let o=e.getObject()["approvedBy"];if(!i.hasOwnProperty(o)&&o!==null){i[o]=e.getObject()["approvedBy"];i["dataToDisplay"].push({approvedBy:o})}let g=e.getObject()["connection_object"];if(!n.hasOwnProperty(g)&&g!==null){n[g]=e.getObject()["connection_object"];n["dataToDisplay"].push({connection_object:g})}let c=e.getObject()["customerName"];if(!l.hasOwnProperty(c)&&c!==null){l[c]=e.getObject()["customerName"];l["dataToDisplay"].push({customerName:c})}let h=e.getObject()["streetNumber"];if(!r.hasOwnProperty(h)&&h!==null){r[h]=e.getObject()["streetNumber"];r["dataToDisplay"].push({streetNumber:h})}let p=e.getObject()["streetName"];if(!d.hasOwnProperty(p)&&p!==null){d[p]=e.getObject()["streetName"];d["dataToDisplay"].push({streetName:p})}let u=e.getObject()["record_status"];if(!s.hasOwnProperty(u.toLowerCase())&&u!==null){s[u.toLowerCase()]=e.getObject()["record_status"].toLowerCase();s["dataToDisplay"].push({key:u,text:u.replace(/^./,u[0].toUpperCase())})}});if(!e){this.localModel.setProperty("/approvedByVH",i.dataToDisplay);this.localModel.setProperty("/connectionObjVH",n.dataToDisplay);this.localModel.setProperty("/recordStatsVH",s.dataToDisplay.sort());this.localModel.setProperty("/custNameVH",l.dataToDisplay);this.localModel.setProperty("/streetNumberVH",r.dataToDisplay);this.localModel.setProperty("/streetNameVH",d.dataToDisplay)}else{this.localModel.setProperty("/tableItemsCount",`Items(${a.length})`);this.localModel.setProperty("/PSOSpecials",a);this.byId("idTable").setBusy(false);if(a.length>0){this.byId("idExcel").setEnabled(true);this.byId("idSort").setEnabled(true)}}this.localModel.refresh(true)}.bind(this))},onBasicSearch:async function(e){let t=this.byId(this._tokensForInput).getParent().getName();if(t=="approvedBy"){let a=await this.apprDialog.getTableAsync();if(a.bindRows){a.getBinding("rows").filter(new o(this.byId(t,"Contains",e.getParameter("newValue"))))}else if(a.bindItems){a.getBinding("items").filter(new o(this.byId(t,"Contains",e.getParameter("newValue"))))}}else if(t=="connection_object"){let a=await this.conObjDialog.getTableAsync();if(a.bindRows){a.getBinding("rows").filter(new o(t,"Contains",e.getParameter("newValue")))}else if(a.bindItems){a.getBinding("items").filter(new o(t,"Contains",e.getParameter("newValue")))}}else if(t=="customerName"){let a=await this.conObjDialog.getTableAsync();if(a.bindRows){a.getBinding("rows").filter(new o(t,"Contains",e.getParameter("newValue")))}else if(a.bindItems){a.getBinding("items").filter(new o(t,"Contains",e.getParameter("newValue")))}}else if(t=="streetName"){let a=await this.conObjDialog.getTableAsync();if(a.bindRows){a.getBinding("rows").filter(new o(t,"Contains",e.getParameter("newValue")))}else if(a.bindItems){a.getBinding("items").filter(new o(t,"Contains",e.getParameter("newValue")))}}else if(t=="streetNumber"){let a=await this.conObjDialog.getTableAsync();if(a.bindRows){a.getBinding("rows").filter(new o(t,"Contains",e.getParameter("newValue")))}else if(a.bindItems){a.getBinding("items").filter(new o(t,"Contains",e.getParameter("newValue")))}}},onValueHelpApprovedBy:function(e){this._tokensForInput=e.getSource().getId();let a=this.byId("idConnObj").getTokens();if(a.length>0){let e=[];a.forEach(t=>{e.push(new o(this.byId("idConnObj").getParent().getName(),"EQ",t.getKey()))});this.filterVH(e,this.byId("idConnObj").getParent().getName())}else{this.readApprByVH()}var i=this;if(!this.apprDialog){t.load({name:"com.pso.changelog.fragments.approvedby",type:"XML",controller:this}).then(e=>{e.setModel(this.localModel);this.apprDialog=e;this.getView().addDependent(this.apprDialog);this.apprDialog.getFilterBar().setBasicSearch(new sap.m.SearchField({liveChange:[i.onBasicSearch,i],value:"{localModel>/basicSearch}",showSearchButton:true}));this.apprDialog.getTableAsync().then(t=>{t.setModel(i.localModel);if(t.bindRows){t.removeAllExtension();t.attachRowSelectionChange(function(e){this.apprDialog.getButtons()[0].firePress({mParameters:{tokens:this.apprDialog._getTokenizer().getTokens(),_tokensHaveChanged:this.apprDialog._bInitTokensHaveChanged,id:this.apprDialog.getId()}})}.bind(this));t.setSelectionMode("Single");t.bindAggregation("rows",{path:"/approvedByVH",events:{dataReceived:function(){e.update()}}})}t.addColumn(new sap.ui.table.Column({label:"Approved By",template:new sap.m.Text({text:"{approvedBy}"})}));if(t.bindItems){t.setMode("SingleSelect");t.bindAggregation("items",{path:"/approvedByVH",template:new sap.m.ColumnListItem({cells:[new sap.m.Label({text:"{approvedBy}"})]}),events:{dataReceived:function(){e.update()}}});t.addColumn(new sap.m.Column({header:new sap.m.Label({text:"Approved By"})}))}});e.update();sap.ui.getCore().byId("idVhStoreDialog-tokenizerGrid").setVisible(false);this.apprDialog.open()})}else{this.apprDialog.open()}},onValueHelpConnObj:function(e){this._tokensForInput=e.getSource().getId();let a=this.byId("idApprBy").getTokens();if(a.length>0){let e=[];a.forEach(t=>{e.push(new o(this.byId("idApprBy").getParent().getName(),"EQ",t.getKey()))});this.filterVH(e,this.byId("idApprBy").getParent().getName())}else{this.readApprByVH()}if(!this.conObjDialog){t.load({name:"com.pso.changelog.fragments.connecObj",type:"XML",controller:this}).then(e=>{e.setModel(this.localModel);this.conObjDialog=e;this.getView().addDependent(this.conObjDialog);var t=this;this.conObjDialog.getFilterBar().setBasicSearch(new sap.m.SearchField({liveChange:[t.onBasicSearch,t],value:"{localModel>/basicSearch}",showSearchButton:true}));this.conObjDialog.getTableAsync().then(o=>{o.setModel(t.localModel);if(o.bindRows){o.removeAllExtension();o.attachRowSelectionChange(function(e){this.conObjDialog.getButtons()[0].firePress({mParameters:{tokens:this.conObjDialog._getTokenizer().getTokens(),_tokensHaveChanged:this.conObjDialog._bInitTokensHaveChanged,id:this.conObjDialog.getId()}})}.bind(this));o.setSelectionMode("Single");o.bindAggregation("rows",{path:"/connectionObjVH",events:{dataReceived:function(){e.update()}}})}o.addColumn(new sap.ui.table.Column({label:"Connection Object",template:new sap.m.Text({text:"{connection_object}"})}));if(o.bindItems){o.setMode("SingleSelect");o.bindAggregation("items",{path:"/connectionObjVH",template:new sap.m.ColumnListItem({cells:[new sap.m.Label({text:"{connection_object}"})]}),events:{dataReceived:function(){e.update()}}});o.addColumn(new sap.m.Column({header:new sap.m.Label({text:"Connection Object"})}))}});e.update();sap.ui.getCore().byId("idVhConObjDialog-tokenizerGrid").setVisible(false);this.conObjDialog.open()})}else{this.conObjDialog.open()}},onValueHelpCustName:function(e){this._tokensForInput=e.getSource().getId();if(!this.custNameDialog){t.load({name:"com.pso.changelog.fragments.custName",type:"XML",controller:this}).then(e=>{e.setModel(this.localModel);this.custNameDialog=e;this.getView().addDependent(this.custNameDialog);var t=this;this.custNameDialog.getFilterBar().setBasicSearch(new sap.m.SearchField({liveChange:[t.onBasicSearch,t],value:"{localModel>/basicSearchForCustName}",showSearchButton:true}));this.custNameDialog.getTableAsync().then(o=>{o.setModel(t.localModel);if(o.bindRows){o.removeAllExtension();o.attachRowSelectionChange(function(e){this.custNameDialog.getButtons()[0].firePress({mParameters:{tokens:this.custNameDialog._getTokenizer().getTokens(),_tokensHaveChanged:this.custNameDialog._bInitTokensHaveChanged,id:this.custNameDialog.getId()}})}.bind(this));o.setSelectionMode("Single");o.bindAggregation("rows",{path:"/custNameVH",events:{dataReceived:function(){e.update()}}})}o.addColumn(new sap.ui.table.Column({label:"Customer Name",template:new sap.m.Text({text:"{customerName}"})}));if(o.bindItems){o.setMode("SingleSelect");o.bindAggregation("items",{path:"/custNameVH",template:new sap.m.ColumnListItem({cells:[new sap.m.Label({text:"{customerName}"})]}),events:{dataReceived:function(){e.update()}}});o.addColumn(new sap.m.Column({header:new sap.m.Label({text:"Customer Name"})}))}});e.update();sap.ui.getCore().byId("idVhCustNameDialog-tokenizerGrid").setVisible(false);this.custNameDialog.open()})}else{this.custNameDialog.open()}},onValueHelpStreet:function(e){this._tokensForInput=e.getSource().getId();if(!this.oStreetNbrDialog){t.load({name:"com.pso.changelog.fragments.street",type:"XML",controller:this}).then(e=>{e.setModel(this.localModel);this.oStreetNbrDialog=e;this.getView().addDependent(this.oStreetNbrDialog);var t=this;this.oStreetNbrDialog.getFilterBar().setBasicSearch(new sap.m.SearchField({liveChange:[t.onBasicSearch,t],value:"{localModel>/basicSearchForStreetNumber}",showSearchButton:true}));this.oStreetNbrDialog.getTableAsync().then(o=>{o.setModel(t.localModel);if(o.bindRows){o.removeAllExtension();o.attachRowSelectionChange(function(e){this.oStreetNbrDialog.getButtons()[0].firePress({mParameters:{tokens:this.oStreetNbrDialog._getTokenizer().getTokens(),_tokensHaveChanged:this.oStreetNbrDialog._bInitTokensHaveChanged,id:this.oStreetNbrDialog.getId()}})}.bind(this));o.setSelectionMode("Single");o.bindAggregation("rows",{path:"/streetNumberVH",events:{dataReceived:function(){e.update()}}})}o.addColumn(new sap.ui.table.Column({label:"Street Number",template:new sap.m.Text({text:"{streetNumber}"})}));if(o.bindItems){o.setMode("SingleSelect");o.bindAggregation("items",{path:"/streetNumberVH",template:new sap.m.ColumnListItem({cells:[new sap.m.Label({text:"{streetNumber}"})]}),events:{dataReceived:function(){e.update()}}});o.addColumn(new sap.m.Column({header:new sap.m.Label({text:"Street Number"})}))}});e.update();sap.ui.getCore().byId("idVhStreetDialog-tokenizerGrid").setVisible(false);this.oStreetNbrDialog.open()})}else{this.oStreetNbrDialog.open()}},onValueHelpStreetAddr:function(e){this._tokensForInput=e.getSource().getId();if(!this.oStreetAddrDialog){t.load({name:"com.pso.changelog.fragments.streetAddress",type:"XML",controller:this}).then(e=>{e.setModel(this.localModel);this.oStreetAddrDialog=e;this.getView().addDependent(this.oStreetAddrDialog);var t=this;this.oStreetAddrDialog.getFilterBar().setBasicSearch(new sap.m.SearchField({liveChange:[t.onBasicSearch,t],value:"{localModel>/basicSearchForStreetName}",showSearchButton:true}));this.oStreetAddrDialog.getTableAsync().then(o=>{o.setModel(t.localModel);if(o.bindRows){o.removeAllExtension();o.attachRowSelectionChange(function(e){this.oStreetAddrDialog.getButtons()[0].firePress({mParameters:{tokens:this.oStreetAddrDialog._getTokenizer().getTokens(),_tokensHaveChanged:this.oStreetAddrDialog._bInitTokensHaveChanged,id:this.oStreetAddrDialog.getId()}})}.bind(this));o.setSelectionMode("Single");o.bindAggregation("rows",{path:"/streetNameVH",events:{dataReceived:function(){e.update()}}})}o.addColumn(new sap.ui.table.Column({label:"Street Name",template:new sap.m.Text({text:"{streetName}"})}));if(o.bindItems){o.setMode("SingleSelect");o.bindAggregation("items",{path:"/streetNameVH",template:new sap.m.ColumnListItem({cells:[new sap.m.Label({text:"{streetName}"})]}),events:{dataReceived:function(){e.update()}}});o.addColumn(new sap.m.Column({header:new sap.m.Label({text:"Street Name"})}))}});e.update();sap.ui.getCore().byId("idVhStreetAddrDialog-tokenizerGrid").setVisible(false);this.oStreetAddrDialog.open()})}else{this.oStreetAddrDialog.open()}},onValueHelpCancelPress:function(e){this._tokensForInput=undefined;e.getSource().close()},onValueHelpOkPress:function(e){if(this._tokensForInput!==undefined){if(e!=undefined){this.byId(this._tokensForInput).setTokens(e.getSource()._getTokenizer().getTokens());e.getSource().close();this._tokensForInput=undefined}else{let e;if(this._tokensForInput.includes("idConnObj")){e=this.conObjDialog}else if(this._tokensForInput.includes("idApprBy")){e=this.apprDialog}else if(this._tokensForInput.includes("idCustName")){e=this.custNameDialog}else if(this._tokensForInput.includes("idStreet")){e=this.oStreetNbrDialog}else if(this._tokensForInput.includes("idStreetAddr")){e=this.oStreetAddrDialog}this.byId(this._tokensForInput).setTokens(e._getTokenizer().getTokens());e.close();if(e.getTable().getSelectedIndex()!=-1){this._tokensForInput=undefined}}}},onRowSelect:function(e){this.getOwnerComponent().getModel("localModel").setProperty("/selectedItem",e.getParameters().listItem.getBindingContext("localModel").getObject());this.getOwnerComponent().getRouter().navTo("RoutedetailPage",{ID:e.getParameters().listItem.getBindingContext("localModel").getObject().ID,connection_object:e.getParameters().listItem.getBindingContext("localModel").getObject().connection_object})},onFilterBarClear:function(e){this.byId("idExcel").setEnabled(false);this.byId("idSort").setEnabled(false);e.mParameters.selectionSet.forEach(e=>{if(e.getMetadata().getName().toLowerCase().includes("multiinput")){e.removeAllTokens()}else if(e.getMetadata().getName().toLowerCase().includes("select")){e.setSelectedKey("Approved")}});this.localModel.setProperty("/PSOSpecials",[]);this.localModel.refresh(true)},onFilterBarSearch:function(e){this.byId("idTable").setBusy(true);let t=[];e.getParameter("selectionSet").forEach(e=>{if(!e.getMetadata().getName().toLowerCase().includes("select")){e.getTokens().forEach(a=>{t.push(new o(e.getParent().getName(),"EQ",a.getKey()))})}else{if(e.getSelectedItem().getKey()!="All"){t.push(new o(e.getParent().getName(),"EQ",e.getSelectedItem().getKey()))}}});this.aFilters=t;this.readApprByVH(t,[]);this.byId("idTable").setShowOverlay(false)},onTokenUpdate:function(e){let t;if(e.getParameter("type")=="removed"){t=e.getSource().getTokens().length-1}if(t==0){if(e.getSource().getParent().getName()=="approvedBy"){if(this.apprDialog){this.apprDialog._getTokenizer().removeAllTokens();let e=this.apprDialog.getTable().getSelectedIndices().sort();this.apprDialog.getTable().removeSelectionInterval(e[0],e[e.length-1]);this.apprDialog.getTable()._updateSelection()}}if(e.getSource().getParent().getName()=="connection_object"){if(this.conObjDialog){this.conObjDialog._getTokenizer().removeAllTokens();let e=this.conObjDialog.getTable().getSelectedIndices().sort();this.conObjDialog.getTable().removeSelectionInterval(e[0],e[e.length-1]);this.conObjDialog.getTable()._updateSelection()}}if(e.getSource().getParent().getName()=="customerName"){if(this.custNameDialog){this.custNameDialog._getTokenizer().removeAllTokens();let e=this.custNameDialog.getTable().getSelectedIndices().sort();this.custNameDialog.getTable().removeSelectionInterval(e[0],e[e.length-1]);this.custNameDialog.getTable()._updateSelection()}}if(e.getSource().getParent().getName()=="streetNumber"){if(this.oStreetNbrDialog){this.oStreetNbrDialog._getTokenizer().removeAllTokens();let e=this.oStreetNbrDialog.getTable().getSelectedIndices().sort();this.oStreetNbrDialog.getTable().removeSelectionInterval(e[0],e[e.length-1]);this.oStreetNbrDialog.getTable()._updateSelection()}}if(e.getSource().getParent().getName()=="streetNumber"){if(this.oStreetAddrDialog){this.oStreetAddrDialog._getTokenizer().removeAllTokens();let e=this.oStreetAddrDialog.getTable().getSelectedIndices().sort();this.oStreetAddrDialog.getTable().removeSelectionInterval(e[0],e[e.length-1]);this.oStreetAddrDialog.getTable()._updateSelection()}}}},onExcelDownload:function(e){let t=this.byId("idTable").getColumns();let o=this.byId("idTable").getItems()[0].getCells();this.createColumnConfig(t,o)},createColumnConfig:function(e,t){let o=[];e.forEach((e,a)=>{o.push({label:e.getHeader().getText(),property:t[a].getBindingInfo("text").parts[0].path,width:25})});var i={workbook:{columns:o,hierarchyLevel:"Level",context:{sheetName:"PSOSpecials"}},dataSource:this.localModel.getData().PSOSpecials,fileName:"PSOSpecials.xlsx",worker:false};var n=new a(i);n.build().finally(function(){n.destroy()})},onTableSortConfirm:function(e){this.byId("idTable").setBusy(true);let t=e.getParameter("sortDescending");let o=e.getParameter("sortItem").getKey();this.readApprByVH(this.aFilters,[new n(o,t)]);debugger},onSort:function(e){if(!this.sortDialog){t.load({name:"com.pso.changelog.fragments.TableSort",type:"XML",controller:this}).then(e=>{this.sortDialog=e;this.getView().addDependent(this.sortDialog);this.sortDialog.open()})}else{this.sortDialog.open()}}})});
//# sourceMappingURL=filterinterface.controller.js.map